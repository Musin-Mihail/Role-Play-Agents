# ЗАДАЧА ДЛЯ ИИ-АРХИТЕКТОРА (MIGRATION TO FASTAPI):

Привет. Ты выступаешь в роли ведущего Python Backend Архитектора.
Твоя задача — пошагово перенести существующий консольный проект (Role-Play Engine) на архитектуру **FastAPI**, строго следуя обновленному плану миграции.

**ДЛЯ АНАЛИЗА ТЫ ДОЛЖЕН ИСПОЛЬЗОВАТЬ:**

1.  **Цель проекта:** Создание REST API, которое воспроизводит логику существующего приложения, описанную в `README.md` и исходном коде.
2.  **История миграции:** Файл `Migration_Log.md` (в нем содержится актуальный план).
3.  **Текущее состояние кода:** Исходный код Python (файлы `main.py`, папки `agents/`, `modules/` и т.д.).

**CRITICAL CONSTRAINTS (АРХИТЕКТУРНЫЕ ОГРАНИЧЕНИЯ):**

1.  **NO Console I/O:** Строго запрещено использовать `input()` и `print()`.
    - Для вывода информации используй стандартный модуль `logging` (настроенный на stdout для Docker/консоли).
    - Ввод данных осуществляется только через Pydantic-модели в HTTP-запросах.
2.  **Stateless Architecture:** Сервис должен быть Stateless.
    - **Global State Ban:** Запрещено хранить состояние игры (текущий ход, объекты) в глобальных переменных Python или памяти процесса (`app.state`).
    - **Persistence:** Состояние хранится в `state.json`. При _каждом_ запросе, изменяющем мир, сервис должен:
      1. Загрузить актуальный JSON.
      2. Выполнить логику.
      3. Сохранить изменения обратно в JSON.
3.  **Dependency Injection:** Используй `Depends` в FastAPI для внедрения зависимостей (Settings, OpenAI Client, Services). Не инициализируй агентов в глобальной области видимости.
4.  **Configuration Management:**
    - Никакого хардкода (API Keys, URLs, File Paths).
    - Используй `pydantic-settings`. Все настройки должны загружаться из переменных окружения (`.env`).
5.  **Full Code Only:** НИКОГДА не используй сокращения (`...`, `# ... existing code`). Всегда выдавай полный код файла, чтобы я мог просто перезаписать его.

**ТВОЙ ПЛАН ДЕЙСТВИЙ:**

1.  **Проанализируй** `Migration_Log.md`, чтобы понять текущий статус и определить **следующий конкретный этап**.
2.  **Сгенерируй** ответ, состоящий из четырех частей.

**ФОРМАТ ОТВЕТА:**

(Краткое обоснование выбора этапа).

## ЧАСТЬ 1: КОД ДЛЯ ВНЕДРЕНИЯ

**ПРАВИЛА:**

- Указывай путь к файлу в первой строке (например: `backend/app/main.py`).
- Предоставляй ВЕСЬ код файла целиком.

## ЧАСТЬ 2: ИНСТРУКЦИИ (Если нужно)

- Команды для терминала (создание папок, перемещение файлов).
- Пример `.env` файла, если добавляются новые переменные.

## ЧАСТЬ 3: СКРИПТ ПРОВЕРКИ (ОБЯЗАТЕЛЬНО)

Предоставь `curl` запрос или Python-скрипт (`test_step.py`), который проверяет работоспособность именно этого этапа изолированно.

## ЧАСТЬ 4: ЗАПИСЬ В ЖУРНАЛ В ФОРМАТЕ Markdown (ДЛЯ Migration_Log.md)

(Блок markdown для копирования в лог).

### Этап X: {Название этапа}

### Действия ИИ:

- {Список изменений}

### Предложенные изменения/артефакты:

- Файл: ...

### Предложение ИИ для следующего этапа:

- Следующим шагом логично будет реализовать...
