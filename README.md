# Role-Play Agents Project

# Этот проект представляет собой интерактивную ролевую игру, управляемую набором специализированных ИИ-агентов. Он создает динамичный повествовательный опыт, в котором один персонаж управляется пользователем, а другой — искусственным интеллектом. История развивается пошагово, где каждый ход обрабатывается цепочкой агентов для обеспечения логической последовательности, глубины персонажа и целостности игрового мира.

## Основная концепция

# Игра строится вокруг файла `state.json`, который содержит полное описание игрового мира: сцену, объекты и состояние персонажей. Пользователь вводит действие своего персонажа, а система ИИ-агентов обрабатывает этот ввод, определяет реакцию ИИ-персонажа, обновляет состояние мира и генерирует следующий фрагмент истории.

## Как это работает: жизненный цикл одного хода

# Каждый ход в игре проходит через четко определенную последовательность шагов, выполняемых различными агентами:1) **Ввод пользователя**: Пользователь пишет, что делает его персонаж.

2. **Определение последствий действия пользователя (`ActionConsequenceAgent`)**: Агент анализирует действие пользователя и определяет, как оно изменяет состояние мира в `state.json`. Например, если пользователь берет предмет, агент обновит поля `holding` у персонажа и `location` у предмета.

3. **Выбор действия ИИ (`ActionSelectorAgent`)**: На основе действия пользователя, текущей цели и контекста сцены ИИ-персонаж решает, какое действие предпринять следующим. Этот агент следует строгой иерархии приоритетов: реакция на угрозу > реакция на прямое взаимодействие > достижение личной цели.

4. **Генерация мотивации (`MotivationGeneratorAgent`)**: После того как действие выбрано, этот агент генерирует внутреннюю мотивацию или причину, по которой ИИ-персонаж решил поступить именно так. Это добавляет персонажу глубины и правдоподобности.

5. **Определение последствий действия ИИ (`ActionConsequenceAgent`)**: Так же, как и для пользователя, этот агент определяет, как запланированное действие ИИ повлияет на `state.json`. На выходе он создает список конкретных выполненных действий (например, `["взял нож", "подошел к столу"]`).

6. **Написание истории (`StoryWriterAgent`)**: Агент-сценарист берет выполненные действия, мотивацию, действие пользователя и общий контекст, чтобы написать художественный фрагмент истории от первого лица ИИ-персонажа.

7. **Проверка истории (`StoryVerifierAgent`)**: Агент контроля качества. Он проверяет, соответствует ли написанная история списку выполненных действий. Если в истории есть выдуманные действия или упущены обязательные, она отправляется на доработку. Этот процесс может повторяться до 3 раз.

8. **Обновление состояния и хронологии**: Если все шаги прошли успешно, итоговые изменения сохраняются в `state.json`, а краткое изложение хода (генерируемое `Chronicler`) добавляется в `chronology.txt`.

### Вспомогательные агенты

# - **`TranslatorAgent`**: Используется для перевода элементов интерфейса и логов на другой язык, обеспечивая лучшую читаемость.

- **`WorldDescriptorAgent`**: Преобразует `state.json` в текстовое описание, которое используется другими агентами для понимания контекста.

## Структура проекта

# - `main.py`: Главный исполняемый файл, который запускает игровой цикл.

- `state.json`: "Сердце" игры. Файл, хранящий все состояние игрового мира. Его редактирование позволяет создавать новые сценарии.

- `/agents`: Директория, содержащая классы для каждого ИИ-агента.

- `/modules`: Модули-помощники для управления состоянием, ведения логов, обработки хронологии и других утилит.

- `log.txt`: Подробный лог всех вызовов агентов, их промптов и ответов. Полезен для отладки.

- `chronology.txt`: Краткая история всех ходов в повествовательной форме.

- `review_changes.txt`: Файл, в который сохраняются ключевые решения и результаты хода в удобочитаемом формате.

## Требования

# - Python 3.x

- Библиотека `openai` (`pip install openai`)

- Локальный сервер, совместимый с OpenAI API (например, LM Studio, Ollama), запущенный по адресу `http://localhost:1234/v1`.

## Как запустить

# 1. **Настройте локальный ИИ-сервер**:

- Скачайте и установите LM Studio или другой подобный инструмент.

- Загрузите модель (например, одну из версий Llama, Mistral и т.д.).

- Запустите сервер по адресу `http://localhost:1234/v1`.

2. **Установите зависимости**:

   pip install openai

3. **(Опционально) Настройте сценарий**:

   - Откройте `state.json` и отредактируйте описание сцены, персонажей, их цели и инвентарь, чтобы создать свой собственный сценарий.

4. **Запустите игру**:

   python main.py

5. Следуйте инструкциям в консоли, чтобы выбрать персонажа и начать игру. Для выхода из игры введите `exit`.
